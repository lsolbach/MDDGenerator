<project name="XmiRepository2" default="distribute">

	<property environment="env"/>
	<property file="build.properties"/>
	<property name="common.build.dir" value="${env.COMMON_BUILD_HOME}"/>
	
	<!-- import common build files -->
	<import file="${common.build.dir}/ant/common.properties.xml"/>
	<import file="${common.build.dir}/ant/common.build.xml"/>

	<path id="source.path">
		<path refid="common.source.path"/>
		<pathelement location="${generate.dir}/src"/>
	</path>
	
	<!--
	  - project specific targets
	  -->
	<target name="generate-local" depends="generate-schema,check-generate-required,generate-binding,generate-builders"/>

	<target name="test-local" depends="test-xmiloader"/>
	
	<!-- generate classes from schema -->
	<target name="check-generate-required">
		<uptodate property="generateModel.notRequired" targetfile="${generate.dir}/src/org/soulspace/xmi/marshal/XMI.java" >
		    <srcfiles dir="${generate.dir}/uml" includes="uml1.4.xsd"/>
		</uptodate>
	</target>	
		
	<target name="generate-binding" depends="initialize" unless="generateModel.notRequired">
		<delete quiet="true">
			<fileset dir="${generate.dir}/src/org/soulspace/xmi/marshal" includes="*.java"/>
			<fileset dir="${generate.dir}/src/org/soulspace/xmi/marshal/types" includes="*.java" />
		</delete>
<!--
		<java fork="yes" classname="org.exolab.castor.builder.SourceGenerator" failonerror="yes"  >
			<classpath>
				<pathelement location="./cfg"/>
		        <pathelement location="./bin"/>
				<fileset dir="./lib/runtime">
					<include name="*.jar" />
				</fileset>
			</classpath>
			<arg value="-f"/>
			<!##arg value="-nodesc"/##>
			<!##arg value="-generateImportedSchemas"/##>
			<arg value="-i"/>
			<arg value="${generate.dir}/uml/uml1.4.xsd"/>
			<arg value="-package"/>
			<arg value="org.soulspace.xmi.marshal"/>
			<arg value="-dest"/>
			<arg value="${generate.dir}/src"/>
			<arg value="-types"/>
			<arg value="j2"/>
		</java>
-->
	</target>

	<target name="generate-builders">
<!--
		<xslt
			style="templates/builder.xsl"
			in="${generate.dir}/uml/uml1.4.xsd"
			out="${generate.dir}/src/org/soulspace/xmi/repository/XMIBuilder.java" />
		<xslt
			style="templates/repository.xsl"
			in="${generate.dir}/uml/uml1.4.xsd"
			out="${generate.dir}/src/org/soulspace/xmi/repository/XMIRepository.java" />
-->
	</target>
	
	<target name="test-xmiloader">
		<java
			classname="org.soulspace.xmi.util.XMILoader"
			classpathref="unittest.classpath">
			<arg value="data/refModels/argouml/state.xmi"/>
			<arg value="data/refModels/argouml/usecase.xmi"/>
		</java>
	</target>
	
	<target name="generate-schema">
		<delete>
			<fileset dir="${backup.dir}"/>
		</delete>
		<copy todir="${backup.dir}" overwrite="true">
			<fileset dir="${generate.dir}"/>
		</copy>
		<delete>
			<fileset dir="${generate.dir}"/>
		</delete>
		
		<!--
		  - Generator
		  -->
		<soulmda destdir="${generate.dir}"
                    backupdir="${backup.dir}"
                    templateDirs="templates,../MdaTemplates/std-templates"
                    modelFile="model/uml1.4.xmi"
			>
			<modelGenerator 	name="xmi/schema"
				                imports="lib,model/lib"
								subdir="uml"
								basename="uml1.4"
								extension="xsd"
			/>
			<classGenerator 	name="xmi/element-interface"
                                imports="lib,model/lib,java/lib,java/interface,xmi/base"
								subdir="src"
								extension="java"
								namespaceReplacement="org.soulspace.xmi.uml14.elements"
								stereotype="NONE"
			/>
			<classGenerator 	name="xmi/element-class"
                                imports="lib,model/lib,java/lib,java/class,xmi/base"
								subdir="src"
								prefix="Abstract"
								extension="java"
								namespaceReplacement="org.soulspace.xmi.uml14.elements.impl"
								stereotype ="NONE"
			/>
			<classGenerator 	name="xmi/element-concrete-class"
                                imports="lib,model/lib,java/lib,java/class,xmi/base"
								subdir="src"
								suffix="Impl"
								extension="java"
								namespaceReplacement="org.soulspace.xmi.uml14.elements.impl"
								stereotype ="NONE"
			/>
			<classGenerator 	name="xmi/enum"
                                imports="lib,model/lib,java/lib,java/class,xmi/base"
								subdir="src"
								extension="java"
								namespaceReplacement="org.soulspace.xmi.uml14.types"
								stereotype="enumeration"
			/>
			<classGenerator 	name="xmi/primitive"
                                imports="lib,model/lib,java/lib,java/class,xmi/base"
								subdir="src"
								extension="java"
								namespaceReplacement="org.soulspace.xmi.uml14.primitives"
								stereotype="primitive"
			/>
			<modelGenerator 	name="xmi/repository"
                                imports="lib,model/lib,java/lib,java/class,xmi/base"
								subdir="src"
								baseName="XmiRepositoryImpl"
								extension="java"
								namespaceReplacement="org.soulspace.xmi.uml14.repository"
			/>
			<modelGenerator 	name="xmi/parser"
                                imports="lib,model/lib,java/lib,java/class,xmi/base"
								subdir="src"
								baseName="XmiParserImpl"
								extension="java"
								namespaceReplacement="org.soulspace.xmi.uml14.repository"
			/>
			<modelGenerator 	name="xmi/writer"
                                imports="lib,model/lib,java/lib,java/class,xmi/base"
								subdir="src"
								baseName="XmiWriterImpl"
								extension="java"
								namespaceReplacement="org.soulspace.xmi.uml14.repository"
			/>
		</soulmda>
	</target>
	
</project>